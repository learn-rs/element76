language: python
python:
    - 2.7

env:
    - RUST_VERSION=nightly

notifications:
    email:
        recipients:
            - ci@mathijs.vd-nes.nl
        on_success: never
        on_failure: always

before_install:
    - shippable_retry curl -o ~/rustup.sh https://static.rust-lang.org/rustup.sh
    - shippable_retry sudo apt-get update -q

install:
    - sudo sh ~/rustup.sh --spec=$RUST_VERSION 2> /dev/null
    - ./downloadrustlibdir.sh
    - shippable_retry sudo apt-get -y install nasm qemu-system

before_script:
    - rustc --version
    - cargo --version

script:
    - make
    - "{ sleep 10; echo q; } | qemu-system-i386 -kernel bin/kernel.bin -monitor stdio -display none"
